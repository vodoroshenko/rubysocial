on: 
   push: 
     tags: 
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10 
jobs: 
   backend-frontend: 
     name: Create backend and frontend releases 
     runs-on: ubuntu-latest 
     steps: 
       - name: Check Out Repo 
         uses: actions/checkout@v2 
  
       - name: Get the version 
         id: get_version 
         run: echo ::set-output name=VERSION::$(echo $GITHUB_REF | cut -d / -f 3) 
  
       - name: Login to Docker Hub 
         uses: docker/login-action@v1 
         with: 
           username: xotabich #${{ secrets.DOCKER_HUB_LOGIN }} 
           password: 27888254-55b4-417c-93ac-c226360118eb #${{ secrets.DOCKER_HUB_TOKEN }} 
  
       - name: Set up Docker Buildx 
         id: buildx 
         uses: docker/setup-buildx-action@v1 
  
       #- name: Build and push 
       #  id: docker_build 
       #  uses: docker/build-push-action@v2 
       #  with: 
       #    context: ./ 
       #    file: ./Dockerfile 
       #    push: true 
       #    tags: ${{ secrets.DOCKER_HUB_LOGIN }}/rubysocial:${{ steps.get_version.outputs.VERSION }} 
       #    build-args: | 
       #      RAILS_KEY=${{ secrets.RAILS_KEY }}

       - name: Image digest 
         run: echo ${{ steps.docker_build.outputs.digest }}

       - name: Login to Google Cloud
         id: auth 
         uses: google-github-actions/auth@v0 
         with: 
           credentials_json: ${{ secrets.GOOGLE_CREDENTIALS }}  

       - name: Extract static files 
         id: extract 
         uses: shrink/actions-docker-extract@v1 
         with: 
           image: xotabich/rubysocial:v0.3 
           path: /usr/src/app/public/.

       - name: Upload Dist
         uses: actions/upload-artifact@v2
         with:
           path: ${{ steps.extract.outputs.destination }}
           name: dist

       - name: Upload files to Google Storage
         uses: 'google-github-actions/upload-cloud-storage@v0'
         with:
           path: /usr/src/app/public/.
           destination: rubychat 